import { S as StorageUtils } from "./storage-utils.D_xOaWSl.js";
import { t as timer } from "./timer.0WUSU37P.js";
import "./map.BLuQZHiU.js";
class NotificationUtils {
  static showErrorNotification(message) {
    chrome.notifications.create({
      type: "basic",
      iconUrl: "./assets/favicon.ico",
      title: "Audako System Error",
      message
    });
  }
}
const ALARM_PREFIX = "healthcheck_";
const CHECK_INTERVAL_MINUTES = 1;
let systemStats = {};
const loadSystemStats = async () => {
  systemStats = await StorageUtils.getSystemStats() ?? {};
  return systemStats;
};
const syncStatsToStorage = () => StorageUtils.setSystemStats(systemStats);
const requestAppConfig = async (baseUrl) => {
  const response = await fetch(`${baseUrl}/assets/conf/application.config`, { cache: "no-cache" });
  if (response.status !== 200) {
    throw new Error(response.status.toString());
  }
  return response.json();
};
const observeSystemsHealth = async (systems) => {
  console.log("Observing systems", systems);
  await loadSystemStats();
  const existingAlarms = await chrome.alarms.getAll();
  const healthCheckAlarms = existingAlarms.filter((alarm) => alarm.name.startsWith(ALARM_PREFIX));
  const systemUrls = systems.map((s) => s.url);
  for (const alarm of healthCheckAlarms) {
    const url = alarm.name.replace(ALARM_PREFIX, "");
    if (!systemUrls.includes(url)) {
      await chrome.alarms.clear(alarm.name);
      delete systemStats[url];
    }
  }
  for (const system of systems) {
    const alarmName = ALARM_PREFIX + system.url;
    const existingAlarm = await chrome.alarms.get(alarmName);
    if (!existingAlarm) {
      if (!systemStats[system.url]) {
        systemStats[system.url] = { healthy: true };
      }
      await chrome.alarms.create(alarmName, {
        delayInMinutes: 0,
        periodInMinutes: CHECK_INTERVAL_MINUTES
      });
      console.log(`Created health check alarm for ${system.url}`);
    }
  }
  syncStatsToStorage();
};
const checkSystemHealth = async (systemUrl) => {
  console.log("Checking health for:", systemUrl);
  await loadSystemStats();
  if (!systemStats[systemUrl]) {
    systemStats[systemUrl] = { healthy: true };
  }
  try {
    await requestAppConfig(systemUrl);
    const healthy = true;
    const lastStatus = systemStats[systemUrl];
    if (healthy !== lastStatus.healthy) {
      systemStats[systemUrl] = { healthy };
      syncStatsToStorage();
    }
  } catch (error) {
    const healthy = false;
    const lastStatus = systemStats[systemUrl];
    if (healthy !== lastStatus.healthy) {
      console.log("System unhealthy:", systemUrl);
      NotificationUtils.showErrorNotification(
        `System: ${new URL(systemUrl).hostname} not reachable`
      );
      systemStats[systemUrl] = { healthy };
      syncStatsToStorage();
    }
  }
};
const checkRichHealthCheck = async (systemUrl) => {
  console.log("Rich health check not yet implemented for:", systemUrl);
};
const defaultDeps = {
  getRegisteredSystems: StorageUtils.getRegisteredSystemSettings,
  queryTabs: (queryInfo) => chrome.tabs.query(queryInfo),
  getTab: (tabId) => chrome.tabs.get(tabId),
  executeScript: (options) => chrome.scripting.executeScript(options),
  clearAlarm: (name) => chrome.alarms.clear(name),
  observeSystemsHealth,
  checkSystemHealth,
  checkRichHealthCheck
};
const createInjectedScriptInjector = (deps) => async (tabId) => {
  try {
    await deps.executeScript({
      target: { tabId },
      files: ["build/injected-scripts.js"],
      world: "MAIN",
      injectImmediately: true
    });
    console.log("Injected scripts into MAIN world for tab", tabId);
  } catch (error) {
    console.error("Failed to inject scripts into MAIN world:", error);
  }
};
const createContentInjector = (deps) => async (tabId) => {
  if (!tabId) {
    console.error("Cannot inject content page: tabId is undefined");
    return;
  }
  let errorCount = 0;
  const subscription = timer(0, 250).subscribe(async () => {
    console.log("InjectContentPage", tabId);
    try {
      const tab = await deps.getTab(tabId);
      if (!tab) {
        subscription.unsubscribe();
        return;
      }
      await deps.executeScript({
        target: { tabId, allFrames: true },
        files: ["build/content.js"]
      });
      subscription.unsubscribe();
    } catch (error) {
      errorCount++;
      if (errorCount > 5) {
        subscription.unsubscribe();
        console.error("Failed to inject content page:", error);
      }
    }
  });
};
const findMatchingSystem = (url, systems = []) => systems.find((system) => url?.includes(system.url));
const createNavigationCommittedHandler = (deps, injectInjectedScripts) => async (details) => {
  if (details.frameId !== 0) return;
  const registeredSystems = await deps.getRegisteredSystems();
  const systemSettings = findMatchingSystem(details.url, registeredSystems);
  if (systemSettings?.ft) {
    await injectInjectedScripts(details.tabId);
  }
};
const createNavigationHandler = (deps, injectContentPage) => async (_details) => {
  const activeTab = (await deps.queryTabs({ active: true, currentWindow: true }))[0];
  if (!activeTab || !activeTab.url || !activeTab.id) {
    return true;
  }
  const registeredSystems = await deps.getRegisteredSystems();
  const systemSettings = findMatchingSystem(activeTab.url, registeredSystems);
  if (systemSettings?.ft) {
    await injectContentPage(activeTab.id);
  }
  return true;
};
const createRegisteredSystemsChangeHandler = (deps, injectContentPage) => async (newSystems, oldSystems = []) => {
  console.log("Registered systems changed. New:", newSystems, "Old:", oldSystems);
  const addedSystems = newSystems.filter(
    (system) => !oldSystems.some((existing) => existing.url === system.url)
  );
  if (addedSystems.length > 0) {
    const tabs = await deps.queryTabs({});
    console.log("Checking tabs for newly added systems:", tabs.length);
    for (const addedSystem of addedSystems) {
      for (const tab of tabs) {
        if (tab.url && tab.id && tab.url.includes(addedSystem.url)) {
          await injectContentPage(tab.id);
        }
      }
    }
  }
  await deps.observeSystemsHealth(newSystems);
};
const createStorageChangeHandler = (onRegisteredSystemsChanged) => async (changes) => {
  console.log("Storage changes detected:", changes);
  if (changes.registeredSystems) {
    await onRegisteredSystemsChanged(
      changes.registeredSystems.newValue,
      changes.registeredSystems.oldValue
    );
  }
  return true;
};
const createAlarmHandler = (deps) => async (alarm) => {
  console.log("Alarm triggered:", alarm.name, (/* @__PURE__ */ new Date()).toISOString());
  if (!alarm.name.startsWith("healthcheck_")) {
    return;
  }
  const systemUrl = alarm.name.replace("healthcheck_", "");
  const registeredSystems = await deps.getRegisteredSystems();
  const system = registeredSystems?.find((s) => s.url === systemUrl);
  if (system) {
    await deps.checkSystemHealth(systemUrl);
    if (system.rh) {
      await deps.checkRichHealthCheck(systemUrl);
    }
    return;
  }
  console.log("Clearing alarm for removed system:", systemUrl);
  await deps.clearAlarm(alarm.name);
};
const registerListeners = (handlers) => {
  chrome.webNavigation.onCommitted.addListener(handlers.onNavigationCommitted);
  chrome.webNavigation.onCompleted.addListener(handlers.onNavigationComplete);
  chrome.storage.onChanged.addListener(handlers.onStorageChanged);
  chrome.alarms.onAlarm.addListener(handlers.onAlarm);
};
const initializeHealthChecks = async (deps) => {
  const registeredSystems = await deps.getRegisteredSystems();
  console.log("RegisteredSystems", registeredSystems);
  await deps.observeSystemsHealth(registeredSystems);
};
const bootstrapServiceWorker = (deps) => {
  console.log("Init Service Worker: " + (/* @__PURE__ */ new Date()).toISOString());
  const injectInjectedScripts = createInjectedScriptInjector(deps);
  const injectContentPage = createContentInjector(deps);
  const onNavigationCommitted = createNavigationCommittedHandler(deps, injectInjectedScripts);
  const onNavigationComplete = createNavigationHandler(deps, injectContentPage);
  const onRegisteredSystemsChanged = createRegisteredSystemsChangeHandler(deps, injectContentPage);
  const onStorageChanged = createStorageChangeHandler(onRegisteredSystemsChanged);
  const onAlarm = createAlarmHandler(deps);
  registerListeners({ onNavigationCommitted, onNavigationComplete, onStorageChanged, onAlarm });
  initializeHealthChecks(deps).catch((error) => {
    console.error("Failed to initialize health checks", error);
  });
};
bootstrapServiceWorker(defaultDeps);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2dyb3VuZC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL25vdGlmaWNhdGlvbi11dGlscy50cyIsIi4uLy4uL3NyYy9zZXJ2aWNlcy9oZWFsLWNoZWNrLnNlcnZpY2UudHMiLCIuLi8uLi9zcmMvYmFja2dyb3VuZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uVXRpbHMge1xuICBwdWJsaWMgc3RhdGljIHNob3dFcnJvck5vdGlmaWNhdGlvbihtZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjaHJvbWUubm90aWZpY2F0aW9ucy5jcmVhdGUoe1xuICAgICAgdHlwZTogJ2Jhc2ljJyxcbiAgICAgIGljb25Vcmw6ICcuL2Fzc2V0cy9mYXZpY29uLmljbycsXG4gICAgICB0aXRsZTogJ0F1ZGFrbyBTeXN0ZW0gRXJyb3InLFxuICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHR5cGUgeyBBcHBDb25maWcgfSBmcm9tICcuLi9tb2RlbHMvYXBwLmNvbmZpZyc7XG5pbXBvcnQgdHlwZSB7IFN5c3RlbVNldHRpbmdzIH0gZnJvbSAnLi4vbW9kZWxzL2V4dGVuc2lvbi1zZXR0aW5ncyc7XG5pbXBvcnQgdHlwZSB7IEhlYWx0aENoZWNrUmVzcG9uc2UgfSBmcm9tICcuLi9tb2RlbHMvaGVhbHRoLWNoZWNrLXJlc3BvbnNlJztcbmltcG9ydCB0eXBlIHsgU3lzdGVtU3RhdHVzIH0gZnJvbSAnLi4vbW9kZWxzL3N5c3RlbS1zdGF0dXMnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uVXRpbHMgfSBmcm9tICcuLi91dGlscy9ub3RpZmljYXRpb24tdXRpbHMnO1xuaW1wb3J0IHsgU3RvcmFnZVV0aWxzIH0gZnJvbSAnLi4vdXRpbHMvc3RvcmFnZS11dGlscyc7XG5cbnR5cGUgU3lzdGVtU3RhdHMgPSBSZWNvcmQ8c3RyaW5nLCBTeXN0ZW1TdGF0dXM+O1xuXG5jb25zdCBBTEFSTV9QUkVGSVggPSAnaGVhbHRoY2hlY2tfJztcbmNvbnN0IENIRUNLX0lOVEVSVkFMX01JTlVURVMgPSAxO1xuXG5sZXQgc3lzdGVtU3RhdHM6IFN5c3RlbVN0YXRzID0ge307XG5cbmNvbnN0IGxvYWRTeXN0ZW1TdGF0cyA9IGFzeW5jICgpOiBQcm9taXNlPFN5c3RlbVN0YXRzPiA9PiB7XG4gIHN5c3RlbVN0YXRzID0gKGF3YWl0IFN0b3JhZ2VVdGlscy5nZXRTeXN0ZW1TdGF0cygpKSA/PyB7fTtcbiAgcmV0dXJuIHN5c3RlbVN0YXRzO1xufTtcblxuY29uc3Qgc3luY1N0YXRzVG9TdG9yYWdlID0gKCkgPT4gU3RvcmFnZVV0aWxzLnNldFN5c3RlbVN0YXRzKHN5c3RlbVN0YXRzKTtcblxuY29uc3QgcmVxdWVzdEFwcENvbmZpZyA9IGFzeW5jIChiYXNlVXJsOiBzdHJpbmcpOiBQcm9taXNlPEFwcENvbmZpZz4gPT4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2Jhc2VVcmx9L2Fzc2V0cy9jb25mL2FwcGxpY2F0aW9uLmNvbmZpZ2AsIHsgY2FjaGU6ICduby1jYWNoZScgfSk7XG5cbiAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlLnN0YXR1cy50b1N0cmluZygpKTtcbiAgfVxuXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XG59O1xuXG5leHBvcnQgY29uc3Qgb2JzZXJ2ZVN5c3RlbXNIZWFsdGggPSBhc3luYyAoc3lzdGVtczogU3lzdGVtU2V0dGluZ3NbXSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICBjb25zb2xlLmxvZygnT2JzZXJ2aW5nIHN5c3RlbXMnLCBzeXN0ZW1zKTtcbiAgYXdhaXQgbG9hZFN5c3RlbVN0YXRzKCk7XG5cbiAgY29uc3QgZXhpc3RpbmdBbGFybXMgPSBhd2FpdCBjaHJvbWUuYWxhcm1zLmdldEFsbCgpO1xuICBjb25zdCBoZWFsdGhDaGVja0FsYXJtcyA9IGV4aXN0aW5nQWxhcm1zLmZpbHRlcihhbGFybSA9PiBhbGFybS5uYW1lLnN0YXJ0c1dpdGgoQUxBUk1fUFJFRklYKSk7XG5cbiAgY29uc3Qgc3lzdGVtVXJscyA9IHN5c3RlbXMubWFwKHMgPT4gcy51cmwpO1xuICBmb3IgKGNvbnN0IGFsYXJtIG9mIGhlYWx0aENoZWNrQWxhcm1zKSB7XG4gICAgY29uc3QgdXJsID0gYWxhcm0ubmFtZS5yZXBsYWNlKEFMQVJNX1BSRUZJWCwgJycpO1xuICAgIGlmICghc3lzdGVtVXJscy5pbmNsdWRlcyh1cmwpKSB7XG4gICAgICBhd2FpdCBjaHJvbWUuYWxhcm1zLmNsZWFyKGFsYXJtLm5hbWUpO1xuICAgICAgZGVsZXRlIHN5c3RlbVN0YXRzW3VybF07XG4gICAgfVxuICB9XG5cbiAgZm9yIChjb25zdCBzeXN0ZW0gb2Ygc3lzdGVtcykge1xuICAgIGNvbnN0IGFsYXJtTmFtZSA9IEFMQVJNX1BSRUZJWCArIHN5c3RlbS51cmw7XG4gICAgY29uc3QgZXhpc3RpbmdBbGFybSA9IGF3YWl0IGNocm9tZS5hbGFybXMuZ2V0KGFsYXJtTmFtZSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nQWxhcm0pIHtcbiAgICAgIGlmICghc3lzdGVtU3RhdHNbc3lzdGVtLnVybF0pIHtcbiAgICAgICAgc3lzdGVtU3RhdHNbc3lzdGVtLnVybF0gPSB7IGhlYWx0aHk6IHRydWUgfTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgY2hyb21lLmFsYXJtcy5jcmVhdGUoYWxhcm1OYW1lLCB7XG4gICAgICAgIGRlbGF5SW5NaW51dGVzOiAwLFxuICAgICAgICBwZXJpb2RJbk1pbnV0ZXM6IENIRUNLX0lOVEVSVkFMX01JTlVURVMsXG4gICAgICB9KTtcblxuICAgICAgY29uc29sZS5sb2coYENyZWF0ZWQgaGVhbHRoIGNoZWNrIGFsYXJtIGZvciAke3N5c3RlbS51cmx9YCk7XG4gICAgfVxuICB9XG5cbiAgc3luY1N0YXRzVG9TdG9yYWdlKCk7XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tTeXN0ZW1IZWFsdGggPSBhc3luYyAoc3lzdGVtVXJsOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgY29uc29sZS5sb2coJ0NoZWNraW5nIGhlYWx0aCBmb3I6Jywgc3lzdGVtVXJsKTtcblxuICBhd2FpdCBsb2FkU3lzdGVtU3RhdHMoKTtcblxuICBpZiAoIXN5c3RlbVN0YXRzW3N5c3RlbVVybF0pIHtcbiAgICBzeXN0ZW1TdGF0c1tzeXN0ZW1VcmxdID0geyBoZWFsdGh5OiB0cnVlIH07XG4gIH1cblxuICB0cnkge1xuICAgIGF3YWl0IHJlcXVlc3RBcHBDb25maWcoc3lzdGVtVXJsKTtcbiAgICBjb25zdCBoZWFsdGh5ID0gdHJ1ZTtcbiAgICBjb25zdCBsYXN0U3RhdHVzID0gc3lzdGVtU3RhdHNbc3lzdGVtVXJsXTtcblxuICAgIGlmIChoZWFsdGh5ICE9PSBsYXN0U3RhdHVzLmhlYWx0aHkpIHtcbiAgICAgIHN5c3RlbVN0YXRzW3N5c3RlbVVybF0gPSB7IGhlYWx0aHkgfTtcbiAgICAgIHN5bmNTdGF0c1RvU3RvcmFnZSgpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBoZWFsdGh5ID0gZmFsc2U7XG4gICAgY29uc3QgbGFzdFN0YXR1cyA9IHN5c3RlbVN0YXRzW3N5c3RlbVVybF07XG5cbiAgICBpZiAoaGVhbHRoeSAhPT0gbGFzdFN0YXR1cy5oZWFsdGh5KSB7XG4gICAgICBjb25zb2xlLmxvZygnU3lzdGVtIHVuaGVhbHRoeTonLCBzeXN0ZW1VcmwpO1xuICAgICAgTm90aWZpY2F0aW9uVXRpbHMuc2hvd0Vycm9yTm90aWZpY2F0aW9uKFxuICAgICAgICBgU3lzdGVtOiAke25ldyBVUkwoc3lzdGVtVXJsKS5ob3N0bmFtZX0gbm90IHJlYWNoYWJsZWAsXG4gICAgICApO1xuICAgICAgc3lzdGVtU3RhdHNbc3lzdGVtVXJsXSA9IHsgaGVhbHRoeSB9O1xuICAgICAgc3luY1N0YXRzVG9TdG9yYWdlKCk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tSaWNoSGVhbHRoQ2hlY2sgPSBhc3luYyAoc3lzdGVtVXJsOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgY29uc29sZS5sb2coJ1JpY2ggaGVhbHRoIGNoZWNrIG5vdCB5ZXQgaW1wbGVtZW50ZWQgZm9yOicsIHN5c3RlbVVybCk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0SGVhbHRoQ2hlY0luZm9ybWF0aW9uID0gYXN5bmMgPFQ+KCk6IFByb21pc2U8SGVhbHRoQ2hlY2tSZXNwb25zZTxUPj4gPT4ge1xuICAvLyBUT0RPOiBpbXBsZW1lbnQgd2hlbiBhIGNvbnN1bWVyIGlzIGF2YWlsYWJsZVxuICByZXR1cm4gbnVsbDtcbn07XG4iLCJpbXBvcnQgeyB0aW1lciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHR5cGUgeyBTeXN0ZW1TZXR0aW5ncyB9IGZyb20gJy4vbW9kZWxzL2V4dGVuc2lvbi1zZXR0aW5ncyc7XG5pbXBvcnQge1xuICBjaGVja1JpY2hIZWFsdGhDaGVjayxcbiAgY2hlY2tTeXN0ZW1IZWFsdGgsXG4gIG9ic2VydmVTeXN0ZW1zSGVhbHRoLFxufSBmcm9tICcuL3NlcnZpY2VzL2hlYWwtY2hlY2suc2VydmljZSc7XG5pbXBvcnQgeyBTdG9yYWdlVXRpbHMgfSBmcm9tICcuL3V0aWxzL3N0b3JhZ2UtdXRpbHMnO1xuXG50eXBlIFNlcnZpY2VXb3JrZXJEZXBzID0ge1xuICBnZXRSZWdpc3RlcmVkU3lzdGVtczogdHlwZW9mIFN0b3JhZ2VVdGlscy5nZXRSZWdpc3RlcmVkU3lzdGVtU2V0dGluZ3M7XG4gIHF1ZXJ5VGFiczogdHlwZW9mIGNocm9tZS50YWJzLnF1ZXJ5O1xuICBnZXRUYWI6IHR5cGVvZiBjaHJvbWUudGFicy5nZXQ7XG4gIGV4ZWN1dGVTY3JpcHQ6IHR5cGVvZiBjaHJvbWUuc2NyaXB0aW5nLmV4ZWN1dGVTY3JpcHQ7XG4gIGNsZWFyQWxhcm06IChuYW1lOiBzdHJpbmcpID0+IFByb21pc2U8Ym9vbGVhbj47XG4gIG9ic2VydmVTeXN0ZW1zSGVhbHRoOiB0eXBlb2Ygb2JzZXJ2ZVN5c3RlbXNIZWFsdGg7XG4gIGNoZWNrU3lzdGVtSGVhbHRoOiB0eXBlb2YgY2hlY2tTeXN0ZW1IZWFsdGg7XG4gIGNoZWNrUmljaEhlYWx0aENoZWNrOiB0eXBlb2YgY2hlY2tSaWNoSGVhbHRoQ2hlY2s7XG59O1xuXG5jb25zdCBkZWZhdWx0RGVwczogU2VydmljZVdvcmtlckRlcHMgPSB7XG4gIGdldFJlZ2lzdGVyZWRTeXN0ZW1zOiBTdG9yYWdlVXRpbHMuZ2V0UmVnaXN0ZXJlZFN5c3RlbVNldHRpbmdzLFxuICBxdWVyeVRhYnM6IHF1ZXJ5SW5mbyA9PiBjaHJvbWUudGFicy5xdWVyeShxdWVyeUluZm8pLFxuICBnZXRUYWI6IHRhYklkID0+IGNocm9tZS50YWJzLmdldCh0YWJJZCksXG4gIGV4ZWN1dGVTY3JpcHQ6IG9wdGlvbnMgPT4gY2hyb21lLnNjcmlwdGluZy5leGVjdXRlU2NyaXB0KG9wdGlvbnMpLFxuICBjbGVhckFsYXJtOiBuYW1lID0+IGNocm9tZS5hbGFybXMuY2xlYXIobmFtZSksXG4gIG9ic2VydmVTeXN0ZW1zSGVhbHRoLFxuICBjaGVja1N5c3RlbUhlYWx0aCxcbiAgY2hlY2tSaWNoSGVhbHRoQ2hlY2ssXG59O1xuXG5jb25zdCBjcmVhdGVJbmplY3RlZFNjcmlwdEluamVjdG9yID1cbiAgKGRlcHM6IFBpY2s8U2VydmljZVdvcmtlckRlcHMsICdleGVjdXRlU2NyaXB0Jz4pID0+XG4gIGFzeW5jICh0YWJJZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRlcHMuZXhlY3V0ZVNjcmlwdCh7XG4gICAgICAgIHRhcmdldDogeyB0YWJJZCB9LFxuICAgICAgICBmaWxlczogWydidWlsZC9pbmplY3RlZC1zY3JpcHRzLmpzJ10sXG4gICAgICAgIHdvcmxkOiAnTUFJTicgYXMgYW55LFxuICAgICAgICBpbmplY3RJbW1lZGlhdGVseTogdHJ1ZSxcbiAgICAgIH0gYXMgYW55KTtcbiAgICAgIGNvbnNvbGUubG9nKCdJbmplY3RlZCBzY3JpcHRzIGludG8gTUFJTiB3b3JsZCBmb3IgdGFiJywgdGFiSWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5qZWN0IHNjcmlwdHMgaW50byBNQUlOIHdvcmxkOicsIGVycm9yKTtcbiAgICB9XG4gIH07XG5cbmNvbnN0IGNyZWF0ZUNvbnRlbnRJbmplY3RvciA9XG4gIChkZXBzOiBQaWNrPFNlcnZpY2VXb3JrZXJEZXBzLCAnZ2V0VGFiJyB8ICdleGVjdXRlU2NyaXB0Jz4pID0+XG4gIGFzeW5jICh0YWJJZD86IG51bWJlcik6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIGlmICghdGFiSWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Nhbm5vdCBpbmplY3QgY29udGVudCBwYWdlOiB0YWJJZCBpcyB1bmRlZmluZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZXJyb3JDb3VudCA9IDA7XG5cbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aW1lcigwLCAyNTApLnN1YnNjcmliZShhc3luYyAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnSW5qZWN0Q29udGVudFBhZ2UnLCB0YWJJZCk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB0YWIgPSBhd2FpdCBkZXBzLmdldFRhYih0YWJJZCk7XG4gICAgICAgIGlmICghdGFiKSB7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgZGVwcy5leGVjdXRlU2NyaXB0KHtcbiAgICAgICAgICB0YXJnZXQ6IHsgdGFiSWQsIGFsbEZyYW1lczogdHJ1ZSB9LFxuICAgICAgICAgIGZpbGVzOiBbJ2J1aWxkL2NvbnRlbnQuanMnXSxcbiAgICAgICAgfSk7XG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXJyb3JDb3VudCsrO1xuICAgICAgICBpZiAoZXJyb3JDb3VudCA+IDUpIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5qZWN0IGNvbnRlbnQgcGFnZTonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuY29uc3QgZmluZE1hdGNoaW5nU3lzdGVtID0gKFxuICB1cmw6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgc3lzdGVtczogU3lzdGVtU2V0dGluZ3NbXSA9IFtdLFxuKTogU3lzdGVtU2V0dGluZ3MgfCB1bmRlZmluZWQgPT4gc3lzdGVtcy5maW5kKHN5c3RlbSA9PiB1cmw/LmluY2x1ZGVzKHN5c3RlbS51cmwpKTtcblxuY29uc3QgY3JlYXRlTmF2aWdhdGlvbkNvbW1pdHRlZEhhbmRsZXIgPVxuICAoXG4gICAgZGVwczogUGljazxTZXJ2aWNlV29ya2VyRGVwcywgJ2dldFJlZ2lzdGVyZWRTeXN0ZW1zJyB8ICdleGVjdXRlU2NyaXB0Jz4sXG4gICAgaW5qZWN0SW5qZWN0ZWRTY3JpcHRzOiAodGFiSWQ6IG51bWJlcikgPT4gUHJvbWlzZTx2b2lkPixcbiAgKSA9PlxuICBhc3luYyAoZGV0YWlsczogY2hyb21lLndlYk5hdmlnYXRpb24uV2ViTmF2aWdhdGlvblRyYW5zaXRpb25DYWxsYmFja0RldGFpbHMpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBpZiAoZGV0YWlscy5mcmFtZUlkICE9PSAwKSByZXR1cm47XG5cbiAgICBjb25zdCByZWdpc3RlcmVkU3lzdGVtcyA9IGF3YWl0IGRlcHMuZ2V0UmVnaXN0ZXJlZFN5c3RlbXMoKTtcbiAgICBjb25zdCBzeXN0ZW1TZXR0aW5ncyA9IGZpbmRNYXRjaGluZ1N5c3RlbShkZXRhaWxzLnVybCwgcmVnaXN0ZXJlZFN5c3RlbXMpO1xuXG4gICAgaWYgKHN5c3RlbVNldHRpbmdzPy5mdCkge1xuICAgICAgYXdhaXQgaW5qZWN0SW5qZWN0ZWRTY3JpcHRzKGRldGFpbHMudGFiSWQpO1xuICAgIH1cbiAgfTtcblxuY29uc3QgY3JlYXRlTmF2aWdhdGlvbkhhbmRsZXIgPVxuICAoXG4gICAgZGVwczogUGljazxTZXJ2aWNlV29ya2VyRGVwcywgJ3F1ZXJ5VGFicycgfCAnZ2V0UmVnaXN0ZXJlZFN5c3RlbXMnPixcbiAgICBpbmplY3RDb250ZW50UGFnZTogKHRhYklkPzogbnVtYmVyKSA9PiBQcm9taXNlPHZvaWQ+LFxuICApID0+XG4gIGFzeW5jIChfZGV0YWlsczogY2hyb21lLndlYk5hdmlnYXRpb24uV2ViTmF2aWdhdGlvbkZyYW1lZENhbGxiYWNrRGV0YWlscyk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIGNvbnN0IGFjdGl2ZVRhYiA9IChhd2FpdCBkZXBzLnF1ZXJ5VGFicyh7IGFjdGl2ZTogdHJ1ZSwgY3VycmVudFdpbmRvdzogdHJ1ZSB9KSlbMF07XG5cbiAgICBpZiAoIWFjdGl2ZVRhYiB8fCAhYWN0aXZlVGFiLnVybCB8fCAhYWN0aXZlVGFiLmlkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBjb25zdCByZWdpc3RlcmVkU3lzdGVtcyA9IGF3YWl0IGRlcHMuZ2V0UmVnaXN0ZXJlZFN5c3RlbXMoKTtcbiAgICBjb25zdCBzeXN0ZW1TZXR0aW5ncyA9IGZpbmRNYXRjaGluZ1N5c3RlbShhY3RpdmVUYWIudXJsLCByZWdpc3RlcmVkU3lzdGVtcyk7XG5cbiAgICBpZiAoc3lzdGVtU2V0dGluZ3M/LmZ0KSB7XG4gICAgICBhd2FpdCBpbmplY3RDb250ZW50UGFnZShhY3RpdmVUYWIuaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG5jb25zdCBjcmVhdGVSZWdpc3RlcmVkU3lzdGVtc0NoYW5nZUhhbmRsZXIgPVxuICAoXG4gICAgZGVwczogUGljazxTZXJ2aWNlV29ya2VyRGVwcywgJ3F1ZXJ5VGFicycgfCAnb2JzZXJ2ZVN5c3RlbXNIZWFsdGgnPixcbiAgICBpbmplY3RDb250ZW50UGFnZTogKHRhYklkPzogbnVtYmVyKSA9PiBQcm9taXNlPHZvaWQ+LFxuICApID0+XG4gIGFzeW5jIChuZXdTeXN0ZW1zOiBTeXN0ZW1TZXR0aW5nc1tdLCBvbGRTeXN0ZW1zOiBTeXN0ZW1TZXR0aW5nc1tdID0gW10pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBjb25zb2xlLmxvZygnUmVnaXN0ZXJlZCBzeXN0ZW1zIGNoYW5nZWQuIE5ldzonLCBuZXdTeXN0ZW1zLCAnT2xkOicsIG9sZFN5c3RlbXMpO1xuICAgIGNvbnN0IGFkZGVkU3lzdGVtcyA9IG5ld1N5c3RlbXMuZmlsdGVyKFxuICAgICAgc3lzdGVtID0+ICFvbGRTeXN0ZW1zLnNvbWUoZXhpc3RpbmcgPT4gZXhpc3RpbmcudXJsID09PSBzeXN0ZW0udXJsKSxcbiAgICApO1xuXG4gICAgaWYgKGFkZGVkU3lzdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCB0YWJzID0gYXdhaXQgZGVwcy5xdWVyeVRhYnMoe30pO1xuICAgICAgY29uc29sZS5sb2coJ0NoZWNraW5nIHRhYnMgZm9yIG5ld2x5IGFkZGVkIHN5c3RlbXM6JywgdGFicy5sZW5ndGgpO1xuXG4gICAgICBmb3IgKGNvbnN0IGFkZGVkU3lzdGVtIG9mIGFkZGVkU3lzdGVtcykge1xuICAgICAgICBmb3IgKGNvbnN0IHRhYiBvZiB0YWJzKSB7XG4gICAgICAgICAgaWYgKHRhYi51cmwgJiYgdGFiLmlkICYmIHRhYi51cmwuaW5jbHVkZXMoYWRkZWRTeXN0ZW0udXJsKSkge1xuICAgICAgICAgICAgYXdhaXQgaW5qZWN0Q29udGVudFBhZ2UodGFiLmlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBhd2FpdCBkZXBzLm9ic2VydmVTeXN0ZW1zSGVhbHRoKG5ld1N5c3RlbXMpO1xuICB9O1xuXG5jb25zdCBjcmVhdGVTdG9yYWdlQ2hhbmdlSGFuZGxlciA9XG4gIChcbiAgICBvblJlZ2lzdGVyZWRTeXN0ZW1zQ2hhbmdlZDogKFxuICAgICAgbmV3U3lzdGVtczogU3lzdGVtU2V0dGluZ3NbXSxcbiAgICAgIG9sZFN5c3RlbXM6IFN5c3RlbVNldHRpbmdzW10sXG4gICAgKSA9PiBQcm9taXNlPHZvaWQ+LFxuICApID0+XG4gIGFzeW5jIChjaGFuZ2VzOiB7IFtwOiBzdHJpbmddOiB7IG5ld1ZhbHVlOiBhbnk7IG9sZFZhbHVlOiBhbnkgfSB9KTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgY29uc29sZS5sb2coJ1N0b3JhZ2UgY2hhbmdlcyBkZXRlY3RlZDonLCBjaGFuZ2VzKTtcbiAgICBpZiAoY2hhbmdlcy5yZWdpc3RlcmVkU3lzdGVtcykge1xuICAgICAgYXdhaXQgb25SZWdpc3RlcmVkU3lzdGVtc0NoYW5nZWQoXG4gICAgICAgIGNoYW5nZXMucmVnaXN0ZXJlZFN5c3RlbXMubmV3VmFsdWUsXG4gICAgICAgIGNoYW5nZXMucmVnaXN0ZXJlZFN5c3RlbXMub2xkVmFsdWUsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuY29uc3QgY3JlYXRlQWxhcm1IYW5kbGVyID1cbiAgKFxuICAgIGRlcHM6IFBpY2s8XG4gICAgICBTZXJ2aWNlV29ya2VyRGVwcyxcbiAgICAgICdnZXRSZWdpc3RlcmVkU3lzdGVtcycgfCAnY2hlY2tTeXN0ZW1IZWFsdGgnIHwgJ2NoZWNrUmljaEhlYWx0aENoZWNrJyB8ICdjbGVhckFsYXJtJ1xuICAgID4sXG4gICkgPT5cbiAgYXN5bmMgKGFsYXJtOiBjaHJvbWUuYWxhcm1zLkFsYXJtKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgY29uc29sZS5sb2coJ0FsYXJtIHRyaWdnZXJlZDonLCBhbGFybS5uYW1lLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpO1xuXG4gICAgaWYgKCFhbGFybS5uYW1lLnN0YXJ0c1dpdGgoJ2hlYWx0aGNoZWNrXycpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgc3lzdGVtVXJsID0gYWxhcm0ubmFtZS5yZXBsYWNlKCdoZWFsdGhjaGVja18nLCAnJyk7XG4gICAgY29uc3QgcmVnaXN0ZXJlZFN5c3RlbXMgPSBhd2FpdCBkZXBzLmdldFJlZ2lzdGVyZWRTeXN0ZW1zKCk7XG4gICAgY29uc3Qgc3lzdGVtID0gcmVnaXN0ZXJlZFN5c3RlbXM/LmZpbmQocyA9PiBzLnVybCA9PT0gc3lzdGVtVXJsKTtcblxuICAgIGlmIChzeXN0ZW0pIHtcbiAgICAgIGF3YWl0IGRlcHMuY2hlY2tTeXN0ZW1IZWFsdGgoc3lzdGVtVXJsKTtcblxuICAgICAgaWYgKHN5c3RlbS5yaCkge1xuICAgICAgICBhd2FpdCBkZXBzLmNoZWNrUmljaEhlYWx0aENoZWNrKHN5c3RlbVVybCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ0NsZWFyaW5nIGFsYXJtIGZvciByZW1vdmVkIHN5c3RlbTonLCBzeXN0ZW1VcmwpO1xuICAgIGF3YWl0IGRlcHMuY2xlYXJBbGFybShhbGFybS5uYW1lKTtcbiAgfTtcblxuY29uc3QgcmVnaXN0ZXJMaXN0ZW5lcnMgPSAoaGFuZGxlcnM6IHtcbiAgb25OYXZpZ2F0aW9uQ29tbWl0dGVkOiAoXG4gICAgZGV0YWlsczogY2hyb21lLndlYk5hdmlnYXRpb24uV2ViTmF2aWdhdGlvblRyYW5zaXRpb25DYWxsYmFja0RldGFpbHMsXG4gICkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgb25OYXZpZ2F0aW9uQ29tcGxldGU6IChcbiAgICBkZXRhaWxzOiBjaHJvbWUud2ViTmF2aWdhdGlvbi5XZWJOYXZpZ2F0aW9uRnJhbWVkQ2FsbGJhY2tEZXRhaWxzLFxuICApID0+IFByb21pc2U8Ym9vbGVhbj47XG4gIG9uU3RvcmFnZUNoYW5nZWQ6IChjaGFuZ2VzOiB7XG4gICAgW3A6IHN0cmluZ106IHsgbmV3VmFsdWU6IGFueTsgb2xkVmFsdWU6IGFueSB9O1xuICB9KSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICBvbkFsYXJtOiAoYWxhcm06IGNocm9tZS5hbGFybXMuQWxhcm0pID0+IFByb21pc2U8dm9pZD47XG59KTogdm9pZCA9PiB7XG4gIGNocm9tZS53ZWJOYXZpZ2F0aW9uLm9uQ29tbWl0dGVkLmFkZExpc3RlbmVyKGhhbmRsZXJzLm9uTmF2aWdhdGlvbkNvbW1pdHRlZCk7XG4gIGNocm9tZS53ZWJOYXZpZ2F0aW9uLm9uQ29tcGxldGVkLmFkZExpc3RlbmVyKGhhbmRsZXJzLm9uTmF2aWdhdGlvbkNvbXBsZXRlKTtcbiAgY2hyb21lLnN0b3JhZ2Uub25DaGFuZ2VkLmFkZExpc3RlbmVyKGhhbmRsZXJzLm9uU3RvcmFnZUNoYW5nZWQpO1xuICBjaHJvbWUuYWxhcm1zLm9uQWxhcm0uYWRkTGlzdGVuZXIoaGFuZGxlcnMub25BbGFybSk7XG59O1xuXG5jb25zdCBpbml0aWFsaXplSGVhbHRoQ2hlY2tzID0gYXN5bmMgKFxuICBkZXBzOiBQaWNrPFNlcnZpY2VXb3JrZXJEZXBzLCAnb2JzZXJ2ZVN5c3RlbXNIZWFsdGgnIHwgJ2dldFJlZ2lzdGVyZWRTeXN0ZW1zJz4sXG4pID0+IHtcbiAgY29uc3QgcmVnaXN0ZXJlZFN5c3RlbXMgPSBhd2FpdCBkZXBzLmdldFJlZ2lzdGVyZWRTeXN0ZW1zKCk7XG4gIGNvbnNvbGUubG9nKCdSZWdpc3RlcmVkU3lzdGVtcycsIHJlZ2lzdGVyZWRTeXN0ZW1zKTtcblxuICBhd2FpdCBkZXBzLm9ic2VydmVTeXN0ZW1zSGVhbHRoKHJlZ2lzdGVyZWRTeXN0ZW1zKTtcbn07XG5cbmNvbnN0IGJvb3RzdHJhcFNlcnZpY2VXb3JrZXIgPSAoZGVwczogU2VydmljZVdvcmtlckRlcHMpID0+IHtcbiAgY29uc29sZS5sb2coJ0luaXQgU2VydmljZSBXb3JrZXI6ICcgKyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpO1xuXG4gIGNvbnN0IGluamVjdEluamVjdGVkU2NyaXB0cyA9IGNyZWF0ZUluamVjdGVkU2NyaXB0SW5qZWN0b3IoZGVwcyk7XG4gIGNvbnN0IGluamVjdENvbnRlbnRQYWdlID0gY3JlYXRlQ29udGVudEluamVjdG9yKGRlcHMpO1xuICBjb25zdCBvbk5hdmlnYXRpb25Db21taXR0ZWQgPSBjcmVhdGVOYXZpZ2F0aW9uQ29tbWl0dGVkSGFuZGxlcihkZXBzLCBpbmplY3RJbmplY3RlZFNjcmlwdHMpO1xuICBjb25zdCBvbk5hdmlnYXRpb25Db21wbGV0ZSA9IGNyZWF0ZU5hdmlnYXRpb25IYW5kbGVyKGRlcHMsIGluamVjdENvbnRlbnRQYWdlKTtcbiAgY29uc3Qgb25SZWdpc3RlcmVkU3lzdGVtc0NoYW5nZWQgPSBjcmVhdGVSZWdpc3RlcmVkU3lzdGVtc0NoYW5nZUhhbmRsZXIoZGVwcywgaW5qZWN0Q29udGVudFBhZ2UpO1xuICBjb25zdCBvblN0b3JhZ2VDaGFuZ2VkID0gY3JlYXRlU3RvcmFnZUNoYW5nZUhhbmRsZXIob25SZWdpc3RlcmVkU3lzdGVtc0NoYW5nZWQpO1xuICBjb25zdCBvbkFsYXJtID0gY3JlYXRlQWxhcm1IYW5kbGVyKGRlcHMpO1xuXG4gIHJlZ2lzdGVyTGlzdGVuZXJzKHsgb25OYXZpZ2F0aW9uQ29tbWl0dGVkLCBvbk5hdmlnYXRpb25Db21wbGV0ZSwgb25TdG9yYWdlQ2hhbmdlZCwgb25BbGFybSB9KTtcblxuICBpbml0aWFsaXplSGVhbHRoQ2hlY2tzKGRlcHMpLmNhdGNoKGVycm9yID0+IHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBoZWFsdGggY2hlY2tzJywgZXJyb3IpO1xuICB9KTtcbn07XG5cbmJvb3RzdHJhcFNlcnZpY2VXb3JrZXIoZGVmYXVsdERlcHMpO1xuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFPLE1BQU0sa0JBQWtCO0FBQUEsRUFDN0IsT0FBYyxzQkFBc0IsU0FBdUI7QUFDekQsV0FBTyxjQUFjLE9BQU87QUFBQSxNQUMxQixNQUFNO0FBQUEsTUFDTixTQUFTO0FBQUEsTUFDVCxPQUFPO0FBQUEsTUFDUDtBQUFBLElBQUEsQ0FDRDtBQUFBLEVBQ0g7QUFDRjtBQ0FBLE1BQU0s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
